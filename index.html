<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Found@Campus Pinboard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1><img class="found-logo" src="./assets/bg found.png" alt="logo" srcset=""> Found@Campus Pinboard</h1>
        <div id="auth-status" class="auth-status">
          <span id="user-info"></span>
          <button
            id="sign-out-btn"
            class="btn btn-secondary"
            style="display: none"
          >
            Sign Out
          </button>
        </div>
      </header>

      <!-- Login Section -->
      <section id="login-section" class="login-section">
        <div class="login-card">
          <h2>Welcome to Campus Lost & Found</h2>
          <p>Sign in with your college email to post and view items</p>
          <button id="sign-in-btn" class="btn btn-primary">
            Sign in with Google
          </button>
          <p id="auth-error" class="error-message" style="display: none"></p>
        </div>
      </section>

      <!-- Main Content (shown when logged in) -->
      <div id="main-content" style="display: none">
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button id="toggle-form-btn" class="btn btn-primary">
            <span class="btn-icon">âž•</span> Post New Item
          </button>
          <button id="open-chatbot-btn" class="btn btn-primary">
            <span class="btn-icon">ðŸ’¬</span> Ask Campus Assistant
          </button>
        </div>

        <!-- Post Form Section -->
        <section id="post-section" class="post-section" style="display: none">
          <h2>Post an Item</h2>
          <form id="found-item-form" class="found-item-form">
            <!-- Item Type Selection -->
            <div class="form-group">
              <label>Item Type *</label>
              <div class="item-type-selector">
                <label class="radio-card">
                  <input type="radio" name="itemType" value="found" checked />
                  <div class="radio-card-content">
                    <span class="radio-icon"></span>
                    <span class="radio-label">Found Item</span>
                    <span class="radio-desc">I found something</span>
                  </div>
                </label>
                <label class="radio-card">
                  <input type="radio" name="itemType" value="lost" />
                  <div class="radio-card-content">
                    <span class="radio-icon"></span>
                    <span class="radio-label">Lost Item</span>
                    <span class="radio-desc">I lost something</span>
                  </div>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="item-name">Item Name *</label>
              <input
                type="text"
                id="item-name"
                name="itemName"
                placeholder="e.g., Blue backpack, iPhone 13, Student ID"
                required
              />
            </div>
            <div class="form-group">
              <label for="location-found" id="location-label">Location Found *</label>
              <input
                type="text"
                id="location-found"
                name="locationFound"
                placeholder="e.g., Library 2nd floor, Cafeteria, Building A"
                required
              />
            </div>
            <div class="form-group">
              <label for="contact-info">Your Contact Info *</label>
              <input
                type="text"
                id="contact-info"
                name="contactInfo"
                placeholder="e.g., Email, Phone number, or WhatsApp"
                required
              />
            </div>
            <div class="form-group">
              <label for="item-image">Item Image (Optional, max 2MB)</label>
              <input
                type="file"
                id="item-image"
                name="itemImage"
                accept="image/*"
              />
              <small class="file-info"
                >Supported formats: JPG, PNG, GIF. Maximum size: 2MB</small
              >
              <div
                id="image-preview"
                class="image-preview"
                style="display: none"
              >
                <img id="preview-img" src="" alt="Preview" />
                <button
                  type="button"
                  id="remove-image"
                  class="btn-remove-image"
                >
                  âœ•
                </button>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                Post Item
              </button>
              <button
                type="button"
                id="cancel-form-btn"
                class="btn btn-secondary"
              >
                Cancel
              </button>
            </div>
          </form>
        </section>

        <!-- Category Tabs -->
        <section class="feed-section">
          <div class="feed-header">
            <div class="category-tabs">
              <button class="tab-btn active" data-category="all">
                <span class="tab-icon">ðŸ“‹</span> All Items
              </button>
              <button class="tab-btn" data-category="found">
                <span class="tab-icon"></span> Found Items
              </button>
              <button class="tab-btn" data-category="lost">
                <span class="tab-icon"></span> Lost Items
              </button>
            </div>
            <div class="search-container">
              <input
                type="text"
                id="search-input"
                placeholder="ðŸ” Search items by name or location..."
                class="search-input"
              />
            </div>
          </div>
          <div id="feed-container" class="feed-container">
            <div id="loading" class="loading">Loading items...</div>
            <div id="empty-state" class="empty-state" style="display: none">
              <p>No items yet. Be the first to post one!</p>
            </div>
            <div id="no-results" class="empty-state" style="display: none">
              <p>No items found matching your search.</p>
            </div>
            <div id="items-list" class="items-list"></div>
          </div>
        </section>
      </div>
    </div>

    <!-- Chatbot Modal -->
    <div id="chatbot-modal" class="chatbot-modal">
      <div class="chatbot-container">
        <div class="chatbot-header">
          <h2>ðŸ’¬ Campus Assistant</h2>
          <button id="close-chatbot-btn" class="close-chatbot-btn">âœ•</button>
        </div>
        <div id="chat-window" class="chat-window">
          <div class="chat-message bot-message">
            <strong>Bot:</strong> Hi! Ask me about any items on campus.
          </div>
        </div>
        <div class="chat-input-container">
          <input
            type="text"
            id="chat-input"
            placeholder="e.g., Has anyone found a red wallet?"
            class="chat-input"
          />
          <button id="send-chat-btn" class="btn btn-primary chat-send-btn">
            Send
          </button>
        </div>
      </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="image-modal">
      <span class="image-modal-close">&times;</span>
      <img class="image-modal-content" id="modal-image">
      <div class="image-modal-caption"></div>
    </div>

    <!-- App Configuration (must load first) -->
    <script src="config.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        GoogleAuthProvider,
        signInWithPopup,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        orderBy,
        onSnapshot,
        serverTimestamp,
        limit,
        getDocs,
        deleteDoc,
        doc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // Check if config is loaded
      if (typeof firebaseConfig === "undefined") {
        console.error(
          "Firebase config not loaded. Make sure config.js is loaded before this script."
        );
        document.body.innerHTML =
          '<div style="padding: 20px; text-align: center;"><h1>Configuration Error</h1><p>Firebase configuration not found. Please check config.js</p></div>';
      } else {
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Make Firebase instances available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseProvider = provider;
        window.firebaseFunctions = {
          signInWithPopup,
          signOut,
          onAuthStateChanged,
          collection,
          addDoc,
          query,
          orderBy,
          onSnapshot,
          serverTimestamp,
          limit,
          getDocs,
          deleteDoc,
          doc,
        };

        // Signal that Firebase is ready
        window.firebaseReady = true;
        window.dispatchEvent(new Event("firebaseReady"));
      }
    </script>

    <!-- App Logic -->
    <script src="app.js"></script>
  </body>
</html>